<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}SG Library{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root { --sidebar-w: 220px; }
    html, body { height: 100%; }
    body { background-color: #f8f9fa; overflow: hidden; font-size: .95rem; }

    .app { display: grid; grid-template-columns: var(--sidebar-w) 1fr; height: 100%; }
    @media (max-width: 767.98px) { .app { grid-template-columns: 1fr; } }

    .sidebar { position: relative; color:#fff; overflow: hidden; }
    .sidebar::before{
        content:"";
        position:absolute;
        inset:0;
        background-image:
          linear-gradient(rgba(0,0,0,.35), rgba(0,0,0,.35)),
          url("https://library.suss.edu.sg/wp-content/uploads/2023/11/Study-Space_High-table-2-cropped-300x200.png");
        background-repeat: no-repeat, no-repeat;
        background-size: 100% 100%, cover;
        background-position: center, left center;
        filter: brightness(1.3);
      }
    .sidebar > .inner{
      position:relative; z-index:1; height:100%;
      display:flex; flex-direction:column; gap:.75rem; padding:1rem;
    }

    .brand{
      font-family:'Open Sans',sans-serif; font-weight:600; font-size:1.4rem;
      letter-spacing:.5px; text-align:center; color:#fff;
    }
    .sidebar hr{ border-top:1px solid rgba(255,255,255,.7); margin:.5rem auto 1rem; width:80%; }
    .sidebar .menu-item{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:.5rem;
      padding-left: 1rem;
    }

    .sidebar .label{
      font-family:'Open Sans',sans-serif; font-weight:400; font-size:1rem; color:rgba(255,255,255,.85);
    }

    .main{ height:100%; overflow:auto; background:#f8f9fa; }

    .page-head{ position:sticky; top:0; z-index:20; border-bottom:1px solid rgba(0,0,0,.06); }

    .topbar-actions{ display:none; }
    @media (max-width: 767.98px){
      .topbar-actions{ display:flex; gap:.5rem; }
    }

    .book-card .card{ border:0; box-shadow:0 1px 4px rgba(0,0,0,.06); }
    .cover{ width:120px; height:160px; object-fit:cover; border-radius:.5rem; }
    @media (max-width: 991.98px){ .cover{ width:140px; height:190px; } }      /* md */
    @media (max-width: 767.98px){ .cover{ width:55vw; height:auto; } }          /* sm */
    @media (max-width: 575.98px){ .cover{ width:70vw; height:auto; } }          /* xs/very small */

    .bg-body-tertiary{ background-color:#eef2f5 !important; }
  </style>

  {% block head %}{% endblock %}
</head>
<body>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar d-none d-md-block">
      <div class="inner text-center">
        <div class="brand mb-2">SG Library</div>
        <hr>

        {% if current_user.is_authenticated %}
  <!-- Profile block (horizontal layout) -->
  <div class="d-flex align-items-center justify-content-start mb-2 px-2">
    {% if current_user.is_admin %}
      <img src="https://img.freepik.com/free-photo/portrait-business-woman-office_1398-6.jpg?semt=ais_hybrid&w=740&q=80"
           alt="Admin" 
           style="width:50px; height:35px; object-fit:cover; border-radius:50% / 40%;">
      <span class="ms-2 text-white fw-semibold">Admin</span>
    {% else %}
      <img src="https://www.shutterstock.com/image-photo/close-head-shot-portrait-focused-600nw-2605781227.jpg"
           alt="User" 
           style="width:50px; height:35px; object-fit:cover; border-radius:50% / 40%;">
      <span class="ms-2 text-white fw-semibold">Non-Admin</span>
    {% endif %}
  </div>
  <hr>
{% endif %}

        <!-- Book Titles link -->
        <div class="menu-item">
          <a href="{{ url_for('books.book_titles') }}" class="text-decoration-none text-white">
            <i class="bi bi-person-vcard-fill fs-5"></i>
            <span class="label">Book Titles</span>
          </a>
        </div>

        <!-- Admin-only New Book link -->
        {% if current_user.is_authenticated and current_user.is_admin %}
          <div class="menu-item">
            <a href="{{ url_for('books.new_book') }}" class="text-decoration-none text-white">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                   fill="currentColor" class="bi bi-cloud-arrow-up-fill me-2"
                   viewBox="0 0 16 16">
                <path d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2m2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0z"/>
              </svg>
              <span class="label">New Book</span>
            </a>
          </div>
        {% endif %}

        <!-- Auth links -->
        {% if not current_user.is_authenticated %}
          <div class="menu-item">
            <a href="{{ url_for('auth.login') }}" class="text-decoration-none text-white">
              <i class="bi bi-box-arrow-in-right fs-5"></i>
              <span class="label">Login</span>
            </a>
          </div>
          <div class="menu-item">
            <a href="{{ url_for('auth.register') }}" class="text-decoration-none text-white">
              <i class="bi bi-person-fill fs-5"></i>
              <span class="label">Register</span>
            </a>
          </div>
        {% else %}
          <div class="menu-item">
            <a href="{{ url_for('auth.logout') }}" class="text-decoration-none text-white">
              <i class="bi bi-box-arrow-right fs-5"></i>
              <span class="label">Logout</span>
            </a>
          </div>
        {% endif %}

        <div class="mt-auto"></div>
      </div>
    </aside>

    <!-- Main -->
    <div class="main">

      <div class="page-head {{ header_class|default('') }}">
        <div class="container py-3 d-flex align-items-center justify-content-between">
          <h1 class="h4 m-0">{% block page_title %}{% endblock %}</h1>

          <div class="topbar-actions">
            <button class="btn btn-outline-secondary btn-sm d-md-none"
                    type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas"
                    aria-controls="sidebarOffcanvas">
              <i class="bi bi-list"></i>
            </button>
            <button class="btn btn-outline-secondary btn-sm d-md-none"
                    type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse"
                    aria-expanded="false" aria-controls="filtersCollapse">
              <i class="bi bi-sliders2"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Flash messages-->
      <div class="container mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} mb-2">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}
      </div>

      {% block content %}{% endblock %}
      <footer class="py-4"></footer>
    </div>
  </div>

  <!-- Offcanvas sidebar for small screens -->
  <div class="offcanvas offcanvas-start d-md-none" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="sidebarOffcanvasLabel">SG Library</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body" style="
      background:
        linear-gradient(rgba(0,0,0,.35), rgba(0,0,0,.35)),
        url('https://library.suss.edu.sg/wp-content/uploads/2023/11/Study-Space_High-table-2-cropped-300x200.png')
        center/cover no-repeat; color:#fff;">

      <!-- Mobile Book Titles -->
      <div class="text-center mb-3">
        <a href="{{ url_for('books.book_titles') }}" class="text-decoration-none text-white">
          <i class="bi bi-person-vcard-fill me-2"></i>
          <span>Book Titles</span>
        </a>
      </div>

      <!-- Mobile Admin-only New Book link -->
      {% if current_user.is_authenticated and current_user.is_admin %}
        <div class="text-center mb-3">
          <a href="{{ url_for('books.new_book') }}" class="text-decoration-none text-white">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                 fill="currentColor" class="bi bi-cloud-arrow-up-fill me-2"
                 viewBox="0 0 16 16">
              <path d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2m2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0z"/>
            </svg>
            <span>New Book</span>
          </a>
        </div>
      {% endif %}

      <!-- Mobile Auth links -->
      {% if not current_user.is_authenticated %}
        <div class="text-center mb-3">
          <a href="{{ url_for('auth.login') }}" class="text-decoration-none text-white">
            <i class="bi bi-box-arrow-in-right me-2"></i> Login
          </a>
        </div>
        <div class="text-center mb-3">
          <a href="{{ url_for('auth.register') }}" class="text-decoration-none text-white">
            <i class="bi bi-person-fill me-2"></i> Register
          </a>
        </div>
      {% else %}
        <div class="text-center mb-3">
          <a href="{{ url_for('auth.logout') }}" class="text-decoration-none text-white">
            <i class="bi bi-box-arrow-right me-2"></i> Logout
          </a>
        </div>
      {% endif %}

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  {% block scripts %}{% endblock %}
</body>
</html>
